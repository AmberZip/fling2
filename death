local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")

-- === SETTINGS ===
local Targets = {"All"} -- "All" to fling everyone else
local FlingToggle = false
local AllBool = false
local DANGER_POS = Vector3.new(-924.05, 304.54, -1.9)
local ESCAPE_DISTANCE = 25

-- === GUI BUTTON ===
local ScreenGui = Instance.new("ScreenGui", Player:WaitForChild("PlayerGui"))
ScreenGui.Name = "FlingToggleUI"
ScreenGui.ResetOnSpawn = false

local Button = Instance.new("TextButton", ScreenGui)
Button.Size = UDim2.new(0, 120, 0, 40)
Button.Position = UDim2.new(0, 10, 1, -50)
Button.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Button.Text = "Fling [OFF]"
Button.Font = Enum.Font.SourceSansBold
Button.TextSize = 18
Button.BorderSizePixel = 0
Button.BackgroundTransparency = 0.1
Button.AutoButtonColor = false

Button.MouseButton1Click:Connect(function()
	FlingToggle = not FlingToggle
	Button.Text = FlingToggle and "Fling [ON]" or "Fling [OFF]"
end)

-- === UTILITIES ===
local function Message(title, text, duration)
	pcall(function()
		StarterGui:SetCore("SendNotification", {
			Title = title,
			Text = text,
			Duration = duration
		})
	end)
end

local function GetPlayer(name)
	name = name:lower()
	if name == "all" or name == "others" then
		AllBool = true
		return
	end
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr.Name:lower():sub(1, #name) == name then
			return plr
		end
	end
end

local function EscapeDanger()
	local char = Player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local dist = (hrp.Position - DANGER_POS).Magnitude
	if dist < ESCAPE_DISTANCE then
		local directionAway = (hrp.Position - DANGER_POS).Unit
		local safePos = hrp.Position + directionAway * (ESCAPE_DISTANCE + 10)
		hrp.CFrame = CFrame.new(safePos)
		hrp.Velocity = directionAway * 100
	end
end

-- === FLING FUNCTION ===
local function SkidFling(TargetPlayer)
	local Character = Player.Character
	local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
	local RootPart = Humanoid and Character:FindFirstChild("HumanoidRootPart")
	if not (Character and Humanoid and RootPart) then return end

	local TCharacter = TargetPlayer.Character
	local THumanoid = TCharacter and TCharacter:FindFirstChildOfClass("Humanoid")
	local TRootPart = THumanoid and TCharacter:FindFirstChild("HumanoidRootPart")
	local THead = TCharacter and TCharacter:FindFirstChild("Head")
	local Accessory = TCharacter and TCharacter:FindFirstChildOfClass("Accessory")
	local Handle = Accessory and Accessory:FindFirstChild("Handle")

	if not (TCharacter and (THead or TRootPart or Handle)) then return end
	if THumanoid and THumanoid.Sit and not AllBool then return end

	local focusPart = THead or TRootPart or Handle
	if not focusPart then return end

	if RootPart.Velocity.Magnitude < 50 then
		getgenv().OldPos = RootPart.CFrame
	end

	local function FPos(part, offset, angle)
		RootPart.CFrame = part.CFrame * offset * angle
		RootPart.Velocity = Vector3.new(1e10, 1e10, 1e10)
		RootPart.RotVelocity = Vector3.new(1e10, 1e10, 1e10)
	end

	local function SFBasePart(part)
		local start = tick()
		local angle = 0
		local BV = Instance.new("BodyVelocity")
		BV.Velocity = Vector3.new(1e15, 1e15, 1e15)
		BV.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
		BV.Parent = RootPart

		while FlingToggle and tick() - start < 1.5 and RootPart and Humanoid and Humanoid.Health > 0 do
			angle += 360

			EscapeDanger()

			FPos(part, CFrame.new(0, 2.7, 0), CFrame.Angles(math.rad(angle), 0, 0))
			task.wait(0.008)
			FPos(part, CFrame.new(0, -2.7, 0), CFrame.Angles(math.rad(angle), 0, 0))
			task.wait(0.008)
		end

		BV:Destroy()
	end

	Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)
	SFBasePart(focusPart)
	Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
	workspace.CurrentCamera.CameraSubject = Humanoid

	if getgenv().OldPos then
		for _ = 1, 5 do
			if RootPart then
				RootPart.CFrame = getgenv().OldPos * CFrame.new(0, .5, 0)
				RootPart.Velocity = Vector3.zero
				RootPart.RotVelocity = Vector3.zero
			end
			task.wait(0)
		end
	end
end

-- === INFINITE LOOP ===
task.spawn(function()
	while true do
		if FlingToggle and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
			pcall(function()
				if #Targets > 0 then
					AllBool = false
					for _, target in pairs(Targets) do
						local targetPlayer = GetPlayer(target)
						if AllBool then
							for _, other in ipairs(Players:GetPlayers()) do
								if other ~= Player then
									SkidFling(other)
								end
							end
						elseif targetPlayer and targetPlayer ~= Player and targetPlayer.UserId ~= 1414978355 then
							SkidFling(targetPlayer)
						end
					end
				end
			end)
		end
		EscapeDanger()
		task.wait(0.01)
	end
end)

-- === RESPAWN SUPPORT ===
Player.CharacterAdded:Connect(function()
	repeat task.wait() until Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
end)

-- === GREETING ===
Message("Script by AnthonyIsntHere", "Toggle fling in bottom left", 5)
